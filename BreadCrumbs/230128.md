# tanstack-query

- suspense를 적용하고 싶어서 react-query를 적용하려함

<br>

단, 아직 모르는게 너무 많음.

특히 다음과 같은 것들은 추후 TIL contents로 사용하기

### 1.

- 상단에서 useQuery hook으로 데이터를 fetching 해왔다가 unmount(브라우저에 dev tool)시켰다가 다시 화면(UI)를 클릭하면 데이터가 사라져버린다.
- 근데 신기한건 undefined가 아니고 data가 빈 배열이 되어버림

```TSX
photo: [{id:1, src: "adc"}]

photo: []
```

→

```
11. why don't comments refresh?

    - 모든 쿼리가 comments 쿼리 키를 동일하게 사용하고 있기 때문
    - 이렇게 comments 같이 알려진 쿼리 키가 있을 때는 어떠한 트리거가 있어야만 데이터를 다시 가져옴.
      - 컴포넌트를 다시 마운트
      - 윈도우를 다시 포커스할 때
      - useQuery에서 반환되어 수동으로 리페칭을 실행할 때
      - 지정된 간격으로 리페칭을 자동 실행할 때
      - Mutation을 생성한 뒤 쿼리를 무효화할 시, 클라이언트 데이터가 서버의 데이터와 불일치 할 때 리페칭이 트리거 됨.

    - 새 블로그 게시물 제목을 클릭할 때는 이런 트리거가 일어나지 않음.
```

- query가 트리거 되는 기준을 살펴보면, 위 현상의 해당하는 경우는 윈도우를 다시 포커스 할 때 인 것 같음.

<br>

### 2.

간단한 CRUD를 구현해보려고 query를 hook으로 각각 만들어보고 있다.
폴더구조는 어떤식으로 잡아야하는지 잘 모르겠어서 queries/ 내 목적에 따라서 나누어줬고, import 시켜서 사용한다.

<br>

### 3.

ssr을 꺼야 suspense를 구현할 수 있다고 하는데 무슨 뜻인지 아직 정확히 모르겠음.

<br>

### 4.

useMutation을 이용해서 삭제 기능을 구현하면 json상에 데이터를 없어지는 반면, UI에서는 50개가 그대로 남아있음 ㅠㅠ..
